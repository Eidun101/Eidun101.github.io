<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cube Dodge 2D Mobile</title>
<style>
  body { margin:0; background:#222; display:flex; justify-content:center; align-items:center; height:100vh; font-family:sans-serif; touch-action: none; }
  canvas { background:#333; display:block; }
  #score { position:absolute; top:20px; left:20px; color:white; font-size:1.5rem; }
  #gameover { display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); 
              background:#ff4757; color:white; padding:20px; text-align:center; border-radius:10px; }
  #gameover button { margin-top:10px; padding:8px 16px; cursor:pointer; border:none; border-radius:6px; background:#0984e3; color:white; }
  #gameover button:hover { background:#74b9ff; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="gameover">
  Game Over! <br> Score: <span id="finalScore">0</span><br>
  <button onclick="restartGame()">Restart</button>
</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 180, y: 550, width: 40, height: 40 };
let obstacles = [];
let score = 0;
let speed = 2;
let isGameOver = false;

// Desktop controls
document.addEventListener('keydown', e => {
  if(isGameOver) return;
  if(e.key==='ArrowLeft') player.x -= 20;
  if(e.key==='ArrowRight') player.x += 20;
  player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
});

// Mobile swipe controls
let startX = null;
canvas.addEventListener('touchstart', e => {
  startX = e.touches[0].clientX;
});
canvas.addEventListener('touchmove', e => {
  if(isGameOver) return;
  let touchX = e.touches[0].clientX;
  let diff = touchX - startX;
  if(Math.abs(diff) > 20){
    player.x += diff > 0 ? 20 : -20;
    player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
    startX = touchX;
  }
});

function createObstacle() {
  let x = Math.random() * (canvas.width - 30);
  obstacles.push({ x: x, y: -30, width: 30, height: 30 });
}

function update() {
  if(isGameOver) return;

  // Move obstacles
  for(let i=obstacles.length-1;i>=0;i--){
    obstacles[i].y += speed;

    // Collision
    if(player.x < obstacles[i].x + obstacles[i].width &&
       player.x + player.width > obstacles[i].x &&
       player.y < obstacles[i].y + obstacles[i].height &&
       player.y + player.height > obstacles[i].y) {
         endGame();
         return;
    }

    // Remove off-screen
    if(obstacles[i].y > canvas.height){
      obstacles.splice(i,1);
      score++;
      document.getElementById('score').textContent = 'Score: '+score;
      speed += 0.05;
    }
  }

  // Occasionally create new obstacle
  if(Math.random()<0.02) createObstacle();
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Player
  ctx.fillStyle='lime';
  ctx.fillRect(player.x, player.y, player.width, player.height);
  // Obstacles
  ctx.fillStyle='red';
  obstacles.forEach(ob => ctx.fillRect(ob.x, ob.y, ob.width, ob.height));
}

function loop() {
  if(isGameOver) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

function startGame() {
  obstacles = [];
  player.x = 180;
  score = 0;
  speed = 2;
  isGameOver = false;
  document.getElementById('score').textContent='Score: 0';
  document.getElementById('gameover').style.display='none';
  loop();
}

function endGame() {
  isGameOver = true;
  document.getElementById('finalScore').textContent=score;
  document.getElementById('gameover').style.display='block';
}

function restartGame(){ startGame(); }

startGame();
</script>
</body>
</html>
